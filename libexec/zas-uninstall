#!/usr/bin/env bash
#
# Summary: Remove zas system hooks
#
# Usage: zas uninstall

set -e

ZASD_PLIST_PATH="$HOME/Library/LaunchAgents/com.zas.zasd.plist"
FIREWALL_PLIST_PATH="/Library/LaunchDaemons/com.zas.firewall.plist"

# Stop and remove the Zas daemon

echo "Stopping the Zas Daemon"
launchctl unload "$ZASD_PLIST_PATH" 2>/dev/null || true
rm -f "$ZASD_PLIST_PATH"

# Uninstall the DNS resolver

echo "Uninstalling DNS resolver"
grep -Rl 'Generated by Zas' /etc/resolver/ | sudo xargs rm

# Uninstall port forwarding

echo "Uninstalling port forward"
sudo launchctl unload "$FIREWALL_PLIST_PATH" 2>/dev/null || true
sudo rm -f "$FIREWALL_PLIST_PATH"
